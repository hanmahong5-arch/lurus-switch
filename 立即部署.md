# ğŸš€ Lurus Switch ç«‹å³éƒ¨ç½²æŒ‡å—

æœåŠ¡å™¨: **115.190.239.146**
ç”¨æˆ·: **root**
å¯†ç : **GGsuperman1211**

---

## âš¡ æ–¹å¼ä¸€:ä½¿ç”¨ä¸€é”®è„šæœ¬ (æ¨è)

### ç¬¬ 1 æ­¥:é…ç½® SSH å¯†é’¥

åœ¨ **Git Bash** æˆ– **PowerShell** ä¸­æ‰§è¡Œ:

```bash
cat ~/.ssh/id_rsa.pub | ssh root@115.190.239.146 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

è¾“å…¥å¯†ç : `GGsuperman1211`

### ç¬¬ 2 æ­¥:è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
cd /d/tools/lurus-switch
bash deploy-now.sh
```

**é¢„è®¡æ—¶é—´**: 5-10 åˆ†é’Ÿ

---

## ğŸ“ æ–¹å¼äºŒ:æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤

å¦‚æœè‡ªåŠ¨è„šæœ¬é‡åˆ°é—®é¢˜,å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

### 1. éªŒè¯ SSH è¿æ¥

```bash
ssh root@115.190.239.146 "echo 'è¿æ¥æˆåŠŸ' && uname -a"
```

### 2. åˆ›å»ºç›®å½•

```bash
ssh root@115.190.239.146 "mkdir -p /opt/lurus/{deploy,data,logs,backup}"
```

### 3. å¤åˆ¶æ–‡ä»¶

```bash
cd D:\tools\lurus-switch

# å¤åˆ¶ä¸»é…ç½®æ–‡ä»¶
scp docker-compose.dev.yaml root@115.190.239.146:/opt/lurus/

# å¤åˆ¶éƒ¨ç½²é…ç½®
scp -r deploy root@115.190.239.146:/opt/lurus/

# å¤åˆ¶ç¯å¢ƒå˜é‡
scp .env.production root@115.190.239.146:/opt/lurus/.env
```

### 4. æ‹‰å– Docker é•œåƒ

```bash
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml pull"
```

**æ³¨æ„**: è¿™ä¸€æ­¥å¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ,å–å†³äºç½‘ç»œé€Ÿåº¦ã€‚

### 5. å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡

```bash
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml up -d postgres redis nats clickhouse consul"
```

### 6. ç­‰å¾…æœåŠ¡åˆå§‹åŒ– (30ç§’)

```bash
sleep 30
```

### 7. å¯åŠ¨ç›‘æ§æœåŠ¡

```bash
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml up -d jaeger prometheus grafana alertmanager"
```

### 8. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
ssh root@115.190.239.146 "docker ps --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}'"
```

---

## âœ… éƒ¨ç½²éªŒè¯

### æ£€æŸ¥æ‰€æœ‰å®¹å™¨æ˜¯å¦è¿è¡Œ

```bash
ssh root@115.190.239.146 "docker ps | grep lurus"
```

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å®¹å™¨åœ¨è¿è¡Œ:
- lurus-postgres
- lurus-redis
- lurus-nats
- lurus-clickhouse
- lurus-consul
- lurus-jaeger
- lurus-prometheus
- lurus-grafana
- lurus-alertmanager

### æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

```bash
# PostgreSQL
ssh root@115.190.239.146 "docker exec lurus-postgres psql -U lurus -c 'SELECT version();'"

# Redis
ssh root@115.190.239.146 "docker exec lurus-redis redis-cli ping"

# NATS
ssh root@115.190.239.146 "curl -s http://localhost:8222/varz | head -10"
```

---

## ğŸŒ è®¿é—®æœåŠ¡

éƒ¨ç½²æˆåŠŸå,åœ¨æµè§ˆå™¨ä¸­è®¿é—®:

| æœåŠ¡ | URL | ç”¨æˆ·å | å¯†ç  |
|------|-----|--------|------|
| Grafana | http://115.190.239.146:3000 | admin | admin |
| Prometheus | http://115.190.239.146:9090 | - | - |
| Jaeger UI | http://115.190.239.146:16686 | - | - |
| Consul UI | http://115.190.239.146:8500 | - | - |

---

## ğŸ“Š æŸ¥çœ‹æ—¥å¿—

### æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—

```bash
# PostgreSQL
ssh root@115.190.239.146 "docker logs -f lurus-postgres"

# Redis
ssh root@115.190.239.146 "docker logs -f lurus-redis"

# NATS
ssh root@115.190.239.146 "docker logs -f lurus-nats"

# Grafana
ssh root@115.190.239.146 "docker logs -f lurus-grafana"
```

### æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—æ‘˜è¦

```bash
ssh root@115.190.239.146 "docker ps --format '{{.Names}}' | xargs -I {} sh -c 'echo === {} === && docker logs --tail 5 {}'"
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
ssh root@115.190.239.146 "docker logs <container-name>"

# é‡å¯å®¹å™¨
ssh root@115.190.239.146 "docker restart <container-name>"
```

### é—®é¢˜ 2: ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
ssh root@115.190.239.146 "netstat -tlnp | grep <port>"

# æŸ¥çœ‹Dockerå®¹å™¨ç«¯å£
ssh root@115.190.239.146 "docker ps --format 'table {{.Names}}\t{{.Ports}}'"
```

### é—®é¢˜ 3: é•œåƒæ‹‰å–å¤±è´¥

```bash
# é…ç½®Dockeré•œåƒåŠ é€Ÿå™¨
ssh root@115.190.239.146 "mkdir -p /etc/docker && cat > /etc/docker/daemon.json << 'EOF'
{
  \"registry-mirrors\": [
    \"https://docker.mirrors.ustc.edu.cn\",
    \"https://hub-mirror.c.163.com\"
  ]
}
EOF
systemctl restart docker
"
```

### é—®é¢˜ 4: é‡æ–°éƒ¨ç½²

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml down"

# åˆ é™¤æ•°æ®å·(å¯é€‰,ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®)
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml down -v"

# é‡æ–°å¯åŠ¨
ssh root@115.190.239.146 "cd /opt/lurus && docker compose -f docker-compose.dev.yaml up -d"
```

---

## ğŸ“ˆ èµ„æºç›‘æ§

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨

```bash
ssh root@115.190.239.146 "docker stats --no-stream"
```

### æŸ¥çœ‹ç£ç›˜ç©ºé—´

```bash
ssh root@115.190.239.146 "df -h"
```

### æŸ¥çœ‹å†…å­˜ä½¿ç”¨

```bash
ssh root@115.190.239.146 "free -h"
```

---

## ğŸ”„ ä¸‹ä¸€æ­¥:éƒ¨ç½²å¾®æœåŠ¡

åŸºç¡€è®¾æ–½éƒ¨ç½²å®Œæˆå,æ‚¨å¯ä»¥éƒ¨ç½²åº”ç”¨å¾®æœåŠ¡:

1. **Gateway Service** (API ç½‘å…³)
2. **Provider Service** (ä¾›åº”å•†ç®¡ç†)
3. **Log Service** (æ—¥å¿—æœåŠ¡)
4. **Billing Service** (è®¡è´¹æœåŠ¡)

éƒ¨ç½²å¾®æœåŠ¡çš„æ­¥éª¤è¯·å‚è€ƒ `README-DEPLOYMENT.md` ä¸­çš„"éƒ¨ç½²å¾®æœåŠ¡"ç« èŠ‚ã€‚

---

## ğŸ“ éœ€è¦å¸®åŠ©?

- æŸ¥çœ‹å®Œæ•´æ–‡æ¡£: `README-DEPLOYMENT.md`
- å¿«é€Ÿå‚è€ƒ: `QUICK-START.md`
- è¯¦ç»†æ­¥éª¤: `DEPLOYMENT-STEPS.md`
